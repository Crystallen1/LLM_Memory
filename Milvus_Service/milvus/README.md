# Milvus å®¢æˆ·ç«¯

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„Milvuså‘é‡æ•°æ®åº“å®¢æˆ·ç«¯ï¼Œæ”¯æŒæ–‡æœ¬åµŒå…¥å‘é‡çš„å­˜å‚¨å’Œç›¸ä¼¼åº¦æœç´¢ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”— è‡ªåŠ¨è¿æ¥å’Œåˆå§‹åŒ–MilvusæœåŠ¡å™¨
- ğŸ“¦ è‡ªåŠ¨åˆ›å»ºé›†åˆå’Œç´¢å¼•
- ğŸ’¾ æ”¯æŒå‘é‡æ•°æ®çš„æ’å…¥ã€æœç´¢å’Œåˆ é™¤
- ğŸ“Š æä¾›é›†åˆç»Ÿè®¡ä¿¡æ¯
- ğŸ›¡ï¸ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- ğŸ§ª åŒ…å«å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹

## ä½¿ç”¨æ–¹æ³•

### 1. åˆ›å»ºå®¢æˆ·ç«¯

```go
import (
    "lc-go/config"
    "lc-go/milvus"
)

// åŠ è½½é…ç½®
cfg := config.Load()

// åˆ›å»ºMilvuså®¢æˆ·ç«¯
client, err := milvus.NewClient(&cfg.Milvus)
if err != nil {
    log.Fatalf("åˆ›å»ºå®¢æˆ·ç«¯å¤±è´¥: %v", err)
}
defer client.Close()
```

### 2. æ’å…¥æ•°æ®

```go
import (
    "lc-go/model"
    "time"
)

// åˆ›å»ºå†…å­˜æ•°æ®
memory := &model.Memory{
    ID:        "unique_id_1",
    Text:      "è¿™æ˜¯è¦å­˜å‚¨çš„æ–‡æœ¬å†…å®¹",
    Embedding: []float32{0.1, 0.2, 0.3, ...}, // 1536ç»´å‘é‡
    CreatedAt: time.Now(),
    UpdatedAt: time.Now(),
}

// æ’å…¥åˆ°Milvus
err := client.Insert(memory)
if err != nil {
    log.Printf("æ’å…¥å¤±è´¥: %v", err)
}
```

### 3. æœç´¢ç›¸ä¼¼å‘é‡

```go
// æœç´¢ç›¸ä¼¼å‘é‡
results, err := client.Search(embedding, 10) // è¿”å›å‰10ä¸ªæœ€ç›¸ä¼¼çš„ç»“æœ
if err != nil {
    log.Printf("æœç´¢å¤±è´¥: %v", err)
}

// å¤„ç†æœç´¢ç»“æœ
for _, result := range results {
    fmt.Printf("ID: %s, æ–‡æœ¬: %s, è·ç¦»: %f, ç›¸ä¼¼åº¦: %f\n", 
        result.ID, result.Text, result.Distance, result.Score)
}
```

### 4. åˆ é™¤æ•°æ®

```go
// æ ¹æ®IDåˆ é™¤æ•°æ®
err := client.Delete("unique_id_1")
if err != nil {
    log.Printf("åˆ é™¤å¤±è´¥: %v", err)
}
```

### 5. è·å–ç»Ÿè®¡ä¿¡æ¯

```go
// è·å–é›†åˆä¸­çš„è®°å½•æ•°
rowCount, err := client.GetCollectionStats()
if err != nil {
    log.Printf("è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥: %v", err)
}
fmt.Printf("é›†åˆä¸­å…±æœ‰ %d æ¡è®°å½•\n", rowCount)
```

## é…ç½®è¯´æ˜

å®¢æˆ·ç«¯ä½¿ç”¨ä»¥ä¸‹é…ç½®å‚æ•°ï¼š

```go
type MilvusConfig struct {
    Host           string // MilvusæœåŠ¡å™¨åœ°å€
    Port           int    // MilvusæœåŠ¡å™¨ç«¯å£
    CollectionName string // é›†åˆåç§°
    Dimension      int    // å‘é‡ç»´åº¦
}
```

## è‡ªåŠ¨åˆå§‹åŒ–

å®¢æˆ·ç«¯åˆ›å»ºæ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. **è¿æ¥æ£€æŸ¥**: éªŒè¯ä¸MilvusæœåŠ¡å™¨çš„è¿æ¥
2. **é›†åˆæ£€æŸ¥**: æ£€æŸ¥æŒ‡å®šçš„é›†åˆæ˜¯å¦å­˜åœ¨
3. **é›†åˆåˆ›å»º**: å¦‚æœé›†åˆä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»ºé›†åˆ
4. **ç´¢å¼•åˆ›å»º**: ä¸ºå‘é‡å­—æ®µåˆ›å»ºFLATç´¢å¼•
5. **é›†åˆåŠ è½½**: å°†é›†åˆåŠ è½½åˆ°å†…å­˜ä¸­ä»¥ä¾›æŸ¥è¯¢

## æ•°æ®ç»“æ„

### Memory ç»“æ„

```go
type Memory struct {
    ID        string    `json:"id"`         // å”¯ä¸€æ ‡è¯†ç¬¦
    Text      string    `json:"text"`       // æ–‡æœ¬å†…å®¹
    Embedding []float32 `json:"embedding"`  // å‘é‡åµŒå…¥
    CreatedAt time.Time `json:"created_at"` // åˆ›å»ºæ—¶é—´
    UpdatedAt time.Time `json:"updated_at"` // æ›´æ–°æ—¶é—´
}
```

### MemoryResult ç»“æ„

```go
type MemoryResult struct {
    ID       string  `json:"id"`        // è®°å½•ID
    Text     string  `json:"text"`      // æ–‡æœ¬å†…å®¹
    Distance float32 `json:"distance"`  // è·ç¦»åˆ†æ•°
    Score    float32 `json:"score"`     // ç›¸ä¼¼åº¦åˆ†æ•°
}
```

## é”™è¯¯å¤„ç†

å®¢æˆ·ç«¯æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š

- è¿æ¥é”™è¯¯ï¼šç½‘ç»œè¿æ¥é—®é¢˜æˆ–æœåŠ¡å™¨ä¸å¯ç”¨
- é›†åˆé”™è¯¯ï¼šé›†åˆåˆ›å»ºã€åˆ é™¤æˆ–è®¿é—®å¤±è´¥
- ç´¢å¼•é”™è¯¯ï¼šç´¢å¼•åˆ›å»ºæˆ–æŸ¥è¯¢å¤±è´¥
- æ•°æ®é”™è¯¯ï¼šæ•°æ®æ’å…¥ã€æœç´¢æˆ–åˆ é™¤å¤±è´¥

## æµ‹è¯•

è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test ./milvus

# è¿è¡Œç‰¹å®šæµ‹è¯•
go test ./milvus -run TestNewClient

# æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
go test ./milvus -v
```

æ³¨æ„ï¼šæµ‹è¯•éœ€è¦è¿è¡Œä¸­çš„MilvusæœåŠ¡å™¨ã€‚å¦‚æœæœåŠ¡å™¨ä¸å¯ç”¨ï¼Œæµ‹è¯•ä¼šè¢«è·³è¿‡ã€‚

## æ€§èƒ½ä¼˜åŒ–

1. **æ‰¹é‡æ“ä½œ**: å¯¹äºå¤§é‡æ•°æ®ï¼Œè€ƒè™‘ä½¿ç”¨æ‰¹é‡æ’å…¥
2. **ç´¢å¼•é€‰æ‹©**: æ ¹æ®æ•°æ®è§„æ¨¡é€‰æ‹©åˆé€‚çš„ç´¢å¼•ç±»å‹
3. **è¿æ¥æ± **: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¿æ¥æ± ç®¡ç†è¿æ¥
4. **å¼‚æ­¥æ“ä½œ**: å¯¹äºéå…³é”®æ“ä½œï¼Œè€ƒè™‘ä½¿ç”¨å¼‚æ­¥å¤„ç†

## æ³¨æ„äº‹é¡¹

1. ç¡®ä¿MilvusæœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
2. å‘é‡ç»´åº¦å¿…é¡»ä¸é…ç½®ä¸­çš„ç»´åº¦ä¸€è‡´
3. IDå­—æ®µå¿…é¡»æ˜¯å”¯ä¸€çš„
4. åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨æ›´å¤æ‚çš„ç´¢å¼•ç±»å‹ï¼ˆå¦‚IVF_FLATï¼‰
5. å®šæœŸç›‘æ§é›†åˆå¤§å°å’Œæ€§èƒ½æŒ‡æ ‡ 